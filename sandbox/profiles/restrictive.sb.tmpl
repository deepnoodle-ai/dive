(version 1)

;; Default deny - explicit allowlist approach
(deny default)

;; Allow reading files from anywhere
(allow file-read*)

;; Allow process execution (children inherit policy)
(allow process-exec)
(allow process-fork)

;; Allow signals to self
(allow signal (target self))

;; Allow writes only to specific paths
(allow file-write*
    (subpath {{.WorkDir}})
    (subpath {{.TmpDir}})
    (literal "/dev/stdout")
    (literal "/dev/stderr")
    (literal "/dev/null")
    {{range .AllowedWritePaths}}
    (subpath {{.}})
    {{end}}
)

;; Terminal/PTY access for interactive commands
(allow file-ioctl (regex #"^/dev/tty.*"))

;; Essential for 'ps', 'top', 'pgrep' (process listing)
(allow mach-lookup (global-name "com.apple.sysmond"))

;; Essential for Go runtime initialization (hardware capabilities)
(allow sysctl-read)

;; Network access
{{if .AllowNetwork}}
(allow network-outbound)
{{else}}
;; Network disabled
{{end}}
